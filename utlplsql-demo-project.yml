trigger: none

pool:
  vmImage: ubuntu-latest

variables:
  CACHE_DIR: $(Pipeline.Workspace)/.cache
  SQLCL_DIR: $(Build.BinariesDirectory)/sqlcl
  UTPLSQL_DIR: $(Build.BinariesDirectory)/utPLSQL
  UTPLSQL_CLI_DIR: $(Build.BinariesDirectory)/utPLSQL-cli
  UTPLSQL_CLI_VERSION: 'v3.1.8'
  UTPLSQL_VERSION: 'v3.1.11' 
  DOCKHER_HUB_REPO: 'utplsqlv3/oracledb'

extends:
  template: templates/t-extend-download-binaries.yml
  parameters:
    packages:
      - name: sqlcl
        download_location: "$(Build.BinariesDirectory)/sqlcl-latest.zip"
        unpack_location: "$(Build.BinariesDirectory)"
        url: "https://download.oracle.com/otn_software/java/sqldeveloper/sqlcl-latest.zip"
        archive: "zip"
        addtoPath: "$(SQLCL_DIR)/bin"

      - name: utlplsqlcli
        download_location: "$(Build.BinariesDirectory)/utPLSQL-cli.zip"
        unpack_location: "$(Build.BinariesDirectory)"
        url: "https://github.com/utPLSQL/utPLSQL-cli/releases/download/$(UTPLSQL_CLI_VERSION)/utPLSQL-cli.zip"
        archive: "zip"
        addToPath: "$(UTPLSQL_CLI_DIR)/bin"
    
  template: templates/t-extend-database-build.yml
  parameters:
    utplsqlVersion: ${UTPLSQL_VERSION}
    utplsqlDir: ${UTPLSQL_DIR}
    targetDatabases:
      - oracleVersion: "19c-se2-small"
        connectionString: "127.0.0.1:1521/ORCLCDB"
        scripts:
          - displayName: "Install utPLSQL"
            user: "sys"
            password: "oracle"           
            script: "install_headless.sql UT3 UT3 users"
            work_dir: "${UTPLSQL_DIR}/source"

