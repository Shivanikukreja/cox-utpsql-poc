trigger: none

pool:
  vmImage: ubuntu-latest

variables:
  CACHE_DIR: $(Pipeline.Workspace)/.cache
  SQLCL_DIR: $(Build.BinariesDirectory)/sqlcl
  UTPLSQL_DIR: $(Build.BinariesDirectory)/utPLSQL
  UTPLSQL_CLI_DIR: $(Build.BinariesDirectory)/utPLSQL-cli
  UTPLSQL_CLI_VERSION: 'v3.1.8'
  UTPLSQL_VERSION: 'v3.1.11' 
  DOCKHER_HUB_REPO: 'utplsqlv3/oracledb'

extends:
  template: templates/t-extend-database-build.yml
    parameters:
      utplsqlVersion: ${UTPLSQL_VERSION}
      utplsqlDir: ${UTPLSQL_DIR}
      addToPaths:
        - path: "$(SQLCL_DIR)/bin"
        - path: "$(UTPLSQL_CLI_DIR)/bin"
      targetDatabases:
        - oracleVersion: "19c-se2-small"
          connectionString: "127.0.0.1:1521/ORCLCDB"
          dockerPortMap: "1521"
          dockerOptions: "--shm-size=1g"
          scripts:
            - displayName: "Install utPLSQL"
              user: "sys"
              password: "oracle"           
              script: "install_headless.sql UT3 UT3 users"
              work_dir: "${UTPLSQL_DIR}/source"

