parameters:
  - name: execute_tests
    type: object
    default:           
      - name : work_dir
        default: $(Build.SourcesDirectory)
      - name: connectionString
        default: ""
      - name: test_user
        default: ""  
      - name: test_pwd
        default: ""
      - name: source_path
        default: ""
      - name: test_path
        default: ""
      - name: options
        default: ""

steps:
- ${{ each test in parameters.execute_tests }}:
  - bash: |
        cd ${{ test.work_dir }}
        utplsql run ${{ test.test_user }}/${{ test.test_pwd }}@//${{ test.connectionString }}?oracle.net.disableOob=true \
          -source_path=${{ test.source_path }} \
          -test_path=${{ test.test_path }} \
          -f=ut_documentation_reporter      -c \
          -f=ut_coverage_sonar_reporter     -o=coverage.xml \
          -f=ut_sonar_test_reporter         -o=test_results.xml \
          -f=ut_coverage_cobertura_reporter -o=cobertura.xml \
          -f=ut_junit_reporter              -o=junit_test_results.xml \
          ${{ test.options }}
    displayName: 'Run Tests'