parameters:
  - name: downloadBinaries
    type: object
    default:
    - name: name
      default: ""  
    - name: download_location
      default: ""
    - name: unpack_location
      default: "$(Build.BinariesDirectory)"    
    - name: url
      default: ""
    - name: archive
      default: "zip"
    - name: addToPath
      default: ""
  - name: createDatabase
    type: object
    default:
      - name: dbname
        default: ""
      - name: oracleVersion
        default: ""  
      - name: dockerOptions
        default: "--shm-size=1g"
      - name: dockerPortMap
        default: "1521"
      - name: connectionString
        default: ""   
      - name: scripts
        type: object
        default:
          - name: work_dir
            default: ""
          - name: user
            default: ""
          - name: password
            default: ""
          - name: script
            default: ""
          - name: displayName
            default: ""
            
jobs:
  - job: BuildDatabase
    displayName: Build Database 
    steps:
      - template: t-task-extend-create-docker-database.yml
        parameters:
          - containerRegistry: ${{ variables.containerRegistry }}
            dockerRepo: ${{ variables.dockerRepo }}
            createDatabase: ${{ parameters.createDatabase }}

      - ${{ each binaries in parameters.downloadBinaries }}:    
        - template: t-task-extend-download-binaries.yml
          parameters:
            - name: ${{ binaries.name }}
              download_location: ${{ binaries.download_location }}
              unpack_location: ${{ binaries.unpack_location }}
              url:  ${{ binaries.url }}
              archive: ${{ binaries.archive }}
              addtoPath: ${{ binaries.addtoPath }} 
      - ${{ each builddatabases in parameters.createDatabase }}:
        - ${{ each script in builddatabases.scripts }}:  
          - template : t-task-extend-sqlcl.yml
            parameters:
              work_dir: ${{ script.work_dir}}
              user: ${{ script.user}}
              password: ${{ script.password}}
              connectionString: ${{ builddatabases.connectionString}}
              script: ${{ script.script}}
              displayName: ${{ script.displayName}}

              