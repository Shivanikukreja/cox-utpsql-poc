parameters:
  - name: installsource
    type: object
    default:
      - name: work_dir
        default: ""
      - name: user
        default: "sys"
      - name: password
        default: "oracle"
      - name: connectionString
        default: ""
      - name: masterchangelogfile
        default: ""

steps:
- ${{ each source in parameters.installsource }}:
  - bash: |
        # Relates to : https://community.oracle.com/tech/developers/discussion/4490418/sqlcl-production-build-21-3-0-278-1045-throwing-warning-terminal-cannot-be-created-paused
        export JAVA_TOOL_OPTIONS=-Dorg.jline.terminal.dumb=true
        cd ${{ source.work_dir }}
        #Issue with 19.3 docker images. fixed in 21
        echo "Will execute : lb update ${{ source.masterchangelogfile }} false from  ${{ source.work_dir }}"
        pwd
        sql ${{ source.user }}/${{ source.password }}@//${{ source.connectionString }}?oracle.net.disableOob=true<<EOF
        lb update utplsql_changelog.xml false
        exit;
        EOF
    displayName: RunLiquibaseUpdate      